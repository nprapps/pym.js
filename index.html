<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
        <link rel="shortcut icon" href="http://media.npr.org/favicon.ico" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css">
        <link href="css/stylesheet.css" rel="stylesheet" type="text/css" media="screen">
        <link href="css/pygment_trac.css" rel="stylesheet" type="text/css" media="screen">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>

        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <title>Pym.js: Embed iframes responsively</title>
    </head>

    <body>
        <div id="container">

            <header>
                <div class="wrapper">
                    <h1>Pym.js</h1>
                    <h2>Embed iframes responsively</h2>

                    <section class="clearfix">
                        <a href="https://github.com/nprapps/pym.js/" id="view-on-github" class="button"><span>View on GitHub</span></a>
                        <a href="./api/pym.js/1.2.0/" id="api" class="button"><span>Browse API docs</span></a>
                        <div class="logos">
                            <a href="http://opennews.org" class="org-logo"><img src="img/opennews-logo.png"></a>
                            <a href="http://blog.apps.npr.org" class="org-logo npr"><img src="http://media.npr.org/chrome/news/nprlogo_138x46.gif"></a>
                            <p><a href="http://opennews.org/code.html">Released for OpenNews Code Convening, April 2014</a></p>
                        </div>
                    </section>
                </div>
            </header>

            <div class="wrapper">
                <section id="about">
                    <h2>About Pym.js</h2>
                    <h3>Latest version: 1.2.0 (released Mar. 8, 2017)</h3>
                    <p>Using iframes in a responsive page can be frustrating. It&rsquo;s easy enough to make an iframe&rsquo;s width span 100% of its container, but sizing its height is tricky &mdash; especially if the content of the iframe changes height depending on page width (for example, because of text wrapping or media queries) or events within the iframe.</p>
                    <p>Pym.js embeds and resizes an iframe responsively (width <em>and</em> height) within its parent container. It also bypasses the usual cross-domain issues.</p>
                    <p><strong>Use case:</strong> The NPR Visuals team uses Pym.js to embed small custom bits of code (charts, maps, etc.) inside our CMS without CSS or JavaScript conflicts. <a href="http://www.npr.org/2014/03/25/293870089/maze-of-college-costs-and-aid-programs-trap-some-families">See an example of this in action.</a></p>
                </section>

                <section id="get-pym">
                    <h2>Getting Pym.js</h2>

                    <h3 id="get-pym-cdn">Use the Pym.js CDN</h3>
                    <p>We recommend in most cases that you use the latest stable version of <code>Pym.js</code> hosted on our content delivery network (CDN) at <code>pym.nprapps.org</code> instead of downloading it directly. We will keep the CDN version up-to-date so that we can fix bugs and add new features and you won't have to change anything. <a href="https://github.com/nprapps/pym.js/tree/master#versioning">Learn more about our versioning strategy.</a></p>

                    <ul>
                        <li><a href="https://pym.nprapps.org/pym.v1.js">https://pym.nprapps.org/pym.v1.js (Uncompressed)</a> (21 KB)</li>
                        <li><a href="https://pym.nprapps.org/pym.v1.min.js">https://pym.nprapps.org/pym.v1.min.js (Compressed)</a> (6 KB)</li>
                    </ul>

                    <p>We recommend using <code>https</code>, but the unsecure <code>http</code> protocol is also supported if you need it.</p>

                    <h3 id="get-pym-download">Download Pym.js</h3>
                    <ul>
                        <li><a href="dist/pym.v1.js">Uncompressed</a> (21 KB)</li>
                        <li><a href="dist/pym.v1.min.js">Compressed</a> (6 KB)</li>
                    </ul>

                    <h3 id="get-pym-npm">Installing with NPM</h3>
                    <p>If you use <a href="http://npmjs.org/">NPM</a> to manage your Javascript dependencies then you can install Pym.js by running:</p>

                    <p><code>npm install pym.js</code></p>

                    <h3 id="get-pym-bower">Installing with Bower</h3>
                    <p>If you use <a href="http://bower.io/">Bower</a> to manage your Javascript dependencies then you can install Pym.js by running:</p>

                    <p><code>bower install pym.js</code></p>

                    <h3 id="get-pym-trouble">Having trouble loading Pym.js in your CMS?</h3>

                    <p><a href="#loader">Learn about pym-loader.js</a>.</p>

                </section>

                <section id="requirements">
                    <h2>Requirements/Assumptions</h2>
                    <ul>
                        <li><code>Pym.js</code> does not require jQuery or any other libraries. Some of the examples use jQuery on the child pages for unrelated features.</li>
                        <li>If you&rsquo;re pasting the iframe embed code into a CMS or blogging software, make sure that it allows you to embed HTML and JavaScript. Some CMSes (such as WordPress) may strip tags out.</li>
                        <li>The parent and child pages do not need to be on the same domain. If they are not, child URLs should be fully-qualified, e.g., <code>http://blog.apps.npr.org/pym.js/examples/graphic/child.html</code></li>
                        <li><code>Pym.js</code> isn't built to handle embedding more than a handful of child frames on the parent. Ten or fewer is a good rule of thumb.</li>
                    </ul>
                </section>

                <section id="browser-support">
                    <h2>Browser support</h2>
                    <p><code>Pym.js</code> has been tested in:</p>
                    <ul>
                        <li>Internet Explorer 9, 10 (Windows 7), 11 (Windows 8.1)</li>
                        <li>Chrome 32 (Mac 10.9)</li>
                        <li>Chrome 51 (Mac 10.11)</li>
                        <li>Firefox 26 (Mac 10.9)</li>
                        <li>Firefox 47 (Mac 10.11)</li>
                        <li>Safari 7 (Mac 10.9)</li>
                        <li>Safari 9 (Mac 10.11)</li>
                        <li>iOS 7 Safari</li>
                        <li>Android 5.1 Browser</li>
                    </ul>
                    <p>Internet Explorer versions earlier than 9 are not supported. If you want to read more about our tests and testing strategy take a look at the docs in the repo <a href="https://github.com/nprapps/pym.js/tree/master#test-the-project">here</a>.</p>
                </section>

                <section id="examples">
                    <h2>Usage</h2>
                    <p>Resize your browser window to see the responsiveness in action.</p>

                    <div class="example-block">
                        <h4>On the Parent Page (Where You&rsquo;re Putting the iFrame)</h4>
                        <ul>
                            <li>Name your containing div (or any other block-level element) with a unique ID.</li>
                            <li>Do not apply any padding or border to your container div. This will throw off pym's height calculations. If you need padding or border around your container, wrap it in another div and apply that there.</li>
                            <li>Include <code>Pym.js</code>. <em>Only once per page</em>, no matter how many iframes you will have.</li>
                            <li>Create a <code>new pym.Parent(parent_id, child_url);</code> for <em>each</em> responsive iframe. (<strong>Pym will generate the actual iframe element.</strong>)</li>
                            <li>Optional: To filter incoming message domains, you can pass in a regex. For example: <code>pym.Parent('example', 'child.html', { xdomain: '\\*\.npr\.org' });</code></li>
                        </ul>

<pre><code>&lt;div id="example"&gt;&lt;/div&gt;
&lt;script type="text/javascript" src="https://pym.nprapps.org/pym.v1.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
    var pymParent = new pym.Parent('example', 'child.html', {});
&lt;/script&gt;
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Multiple Embeds on the Same Parent Page</h4>
                        <p>You don&rsquo;t have to do anything special to the child pages, but you do need to keep a few things in mind for the parent page:</p>
                        <ul>
                            <li>Each child embed needs a unique div ID (<code>&lt;div id="example-1"&gt;</code>, <code>&lt;div id="example-2"&gt;</code>, etc.).</li>
                            <li>Include <code>Pym.js</code> only <em>once</em> on the page.</li>
                        </ul>

                        <h5>HTML Needed on the Parent Page</h5>
<pre><code>&lt;div id="example-1"&gt;&lt;/div&gt;
&lt;div id="example-2"&gt;&lt;/div&gt;
&lt;script type="text/javascript" src="https://pym.nprapps.org/pym.v1.min.js"&gt;&lt;/script&gt;
</code></pre>

                        <h5>Javascript Needed on the Parent Page</h5>
<pre><code>&lt;script&gt;
var pymParent = new pym.Parent('example-1', 'child-1.html', {});
var second = new pym.Parent('example-2', 'child-2.html', {});
&lt;/script&gt;
</code></pre>

                    </div>


                    <div class="example-block">
                        <h4>On the Child Page (The Content You Want to Embed)</h4>
                        <ul>
                            <li>Include <code>Pym.js</code>.</li>
                            <li>Create a <code>new pym.Child();</code>.</li>
                            <li>Optional: If the contents of your iframe are dynamic you will want to pass in a rendering function, like this: <code>pym.Child({ renderCallback: myFunc });</code> This function will be called once when the page loads and again any time the window is resized.</li>
                            <li>Optional: You can pass in a number of milliseconds to enable automaticaly updating the height at that rate (in addition to onload and onresize events). For example: <code>pym.Child({ polling: 500 });</code>.</li>
                            <li>Optional: If you need finer control over resize events, you can invoke <code>pymChild.sendHeight()</code> at any time to force the iframe to update its size.</li>
                        </ul>
                    </div>


                    <div class="example-block">
                        <h4>Example: Basic Embed</h4>
                        <p>In our simplest example, we have an HTML table that changes format (via CSS media queries). The height of the iframe adjusts to the height of the content onload and onresize.</p>

                        <div id="example-table" class="example"></div>

                        <h5>Javascript Needed on the Child Page</h5>
<pre><code>var pymChild = new pym.Child();
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Example: Call a Function When the Page Resizes</h4>
                        <p>This might be useful in cases where sections of your child page need to be redrawn based on the new width. (For example, a graphic generated by D3, which would not stretch or reflow on its own.)</p>

                        <div id="example-graphic" class="example"></div>

                        <h5>Javascript Needed on the Child Page</h5>
<pre><code>function drawGraphic(width) {
    ...
}

var pymChild = new pym.Child({ renderCallback: drawGraphic });
</code></pre>
                    </div>


                    <div class="example-block">
                        <h4>Example: Manual resize events</h4>
                        <p>If you have dynamic content and need finer control over resize events, you can invoke <code>pymChild.sendHeight()</code> in the child window at any time to force the iframe to update its size. For example, say you have a quiz, and the content of the page changes when someone selects an answer, affecting the page&rsquo;s height:</p>

                        <div id="example-quiz" class="example"></div>

                        <h5>Javascript Needed on the Child Page</h5>

<pre><code>function check_answer(e) {
    // highlight the correct answer
    ...

    // send updated height to parent
    pymChild.sendHeight();
}

$('.question').find('li').on('click', check_answer);

var pymChild = new pym.Child();
</code></pre>
                    </div>

                    <div class="example-block">
                        <h4>Example: Resizing after following links in the iframe</h4>
                        <p>If you have links in your iframe that lead to other pages, you can maintain auto-resizing on the subsequent pages by explicitly setting the child ID in each one.</p>

                        <div id="example-follow-links" class="example"></div>

                        <h5>Javascript Needed on Every Child Page</h5>
                        <pre><code>var pymChild = new pym.Child({ id: 'example-follow-links' });
                        </code></pre>

                    </div>

                </section>

                <section id="custom-events">
                    <h2>Sending Custom iFrame Events</h2>

                    <p>Although not its original purpose, <code>Pym.js</code> can also be used to send and receive generic event data between the iframe parent and child. A simple, jQuery-like event binding model is used to support this message passing.</p>

                    <p>In the following example a click on the link in the parent container will navigate the child frame to a new location.</p>

                    <h5>Javascript Needed on the Parent Page</h5>
<pre><code>var pymParent = pym.Parent('example', 'child.html', {});

document.getElementById('myLink').addEventListener('click', onLinkClick);

function onLinkClick(e) {
    e.preventDefault();

    pymParent.sendMessage('navigate', e.target.href);
}
</code></pre>

                    <h5>Javascript needed on the Child page</h5>
<pre><code>var pymChild = new pym.Child();

pymChild.onMessage('navigate', onNavigateMessage);

function onNavigateMessage(url) {
    window.location.href = url;
}
</code></pre>

                    <p>Note that the reverse scenario can be performed as well; children can send messages to the parent with the same <code>sendMessage()</code> function.</p>

                    <h3>Shortcuts for navigating the parent from the child</h3>

                    <p>As scrolling and navigating the parent window is a very common need, there are shortcuts for these actions that do not require you to implement your own events.</p>

                    <h5>Code to scroll and navigate the parent</h5>

<pre><code>pymChild.scrollParentTo('about');
pymChild.navigateParentTo('https://github.com/nprapps/pym.js');
</code></pre>

                    <div id="example-navigation" class="example"></div>

                    <p>Starting in <code>v1.1.0</code> we have included a new shortcut that allows the child to scroll the parent to a given position within the child document. You can pass the offset desired relative to the child page or use a helper function passing it the id of an element within that child page</p>

                    <h5>Code to scroll the parent to a child position</h5>

<pre><code>
// download is the id of an existing HTML element on the child page
pymChild.scrollParentToChildEl('download');
pymChild.scrollParentToChildPos(1000);
</code></pre>

                    <p><a href="examples/scrollParentToChild/">Here</a> you can see an example of the new scroll shortcut in action.

                </section>

                <section id="how">
                    <h2>How It Works</h2>
                    <p>The <code>Pym.js</code> library and a small bit of javascript are injected onto the parent page. This code writes an iframe to the page in a container of your choice. <code>Pym.js</code> will actually replace the contents of the container with the newly created iframe, so it is better to use an empty container from the start to avoid surprises. The request for the iframe&rsquo;s contents includes querystring parameters for the <code>initialWidth</code>, <code>childId</code> of the child page and <code>parentUrl</code> and <code>parentTitle</code> of the parent page. The <code>initialWidth</code> allows the child to know its size immediately on load, because in iOS, the child frame can not determine its own width accurately. The <code>childId</code> allows multiple children to be embedded on the same page, each with its own communication to the parent.</p>
                    <p>The child page also includes <code>Pym.js</code> and its own javascript. It initializes cross-iframe communication to the parent, renders any dynamic content and then sends the computed height of the child to the parent via <code>postMessage</code>. Upon receiving this message the parent resizes the containing iframe, thus ensuring the contents of the child are always visible.</p>
                    <p>The parent page also registers for resize events. Any time one is received, the parent sends the new container width to each child via <code>postMessage</code>. The child re-renders its content and sends back the new height.</p>
                    <p class="note">Extra parameters can be passed to the parent (<code>title</code>, <code>id</code>, <code>name</code>, ...) through a config object that would then be applied as attributes to the generated iFrame. This is a varying list so it is better to check the <a href="./api/pym.js/1.0.0/">API documentation</a> for an up-to-date detailed list</p>
                </section>

                <section id="auto">
                    <h3>Auto-initializing Pym.js</h3>

                    <p>Certain CMSes prevent custom Javascript from being embedded on the page. In order to allow pym to support those environments, it can be initialized via <code>data-</code> attributes. This limits usage of pym to simple cases, but should still be enough for many users.</p>
                    <p>(NPR member stations: <a href="#loader">Use the loader workaround to get this to work in Core Publisher</a>.).</p>

                    <h5>HTML Needed on the Parent Page</h5>

<pre><code>&lt;div data-pym-src="child.html"&gt;Loading...&lt;/div&gt;
&lt;script type="text/javascript" src="https://pym.nprapps.org/pym.v1.min.js"&gt;&lt;/script&gt;
</code></pre>

                    <p>Starting on <code>v1.1.0</code> you can pass configuration parameters as HTML data attributes by just prefixing the parent configuration parameter with <code>data-pym-</code>. To check all the available parent configuration parameters check the API documentation <a href="./api/pym.js/1.1.2/module-pym.Parent.html">here</a>

<pre><code>&lt;div data-pym-src="child.html" data-pym-allowfullscreen&gt;Loading&lt;/div&gt;
&lt;script type="text/javascript" src="https://pym.nprapps.org/pym.v1.min.js"&gt;&lt;/script&gt;
</code></pre>
                </section>

                <section id="loader">
                    <h2>pym-loader.js: The Pym.js loader</h2>

                    <p>Some content management systems prevent custom Javascript from being embedded on the page, others use <code>pjax</code> to load content, and still others use <code>RequireJS</code> to load libraries. Since <code>Pym.js</code> was designed as a library with support for inclusion using <code>AMD</code> and <code>CommonJS</code> we have encountered certain CMSes scenarios were <code>Pym.js</code> broke in some cases or did not load at all.</p>

                    <p>That's why we created <code>pym-loader.js</code>, an additional script that acts as a wrapper to deal with all the nitty gritty details to successfully load <code>Pym.js</code> in many common cases. <code>pym-loader.js</code> was developed after much thought and discussion with developers using <code>Pym.js</code>.</p>

                    <p>Including <code>pym-loader.js</code> on your page automatically and immediately initializes all <code>Pym.js</code>-enabled <code>iframe</code> elements. It works when included via a <code>script</code> tag in environments that use RequireJS and it gracefully handles the complexities of `pjax` navigation.</p>

                    <p><code>pym-loader.js</code> works for the reasonable amount of edge use cases that we have encountered so far and it is our hope it will work for others as well. However, we can't cover all cases. In the future, a one-for-all solution may not work and we may need to release specific loaders for specific edge cases. But at least the <code>Pym.js</code> library will remain isolated from these edge cases.</p>

                    <p>If you have a reasonable amount of control over your CMS's <code>Pym.js</code> implementation, we recommend the raw inclusion of <code>Pym.js</code> as shown in our examples. If you do not have that control over your CMS, are having problems loading <code>Pym.js</code> or just prefer to feel more protected against future changes to your CMS then you can use the loader script.</p>

                    <h5>HTML Needed on the Parent Page</h5>

<pre><code>&lt;p data-pym-src="child.html"&gt;Loading...&lt;/p&gt;
&lt;script type="text/javascript" src="https://pym.nprapps.org/pym-loader.v1.min.js"&gt;&lt;/script&gt;
</code></pre>

                    <p><a href="examples/loader_with_requirejs/">Here</a> you can see an example of <code>pym-loader.js</code> in action together with a page that uses <code>require.js</code> to load its javascript assets</p>
                </section>

                <section id="get-pym-loader">
                    <h2>Getting the Pym.js loader</h2>

                    <h3>Use the Pym.js CDN</h3>

                      <p>We recommend in most cases that you use the latest stable version of <code>Pym.js</code> hosted on our content delivery network (CDN) at <code>pym.nprapps.org</code> instead of downloading it directly. We will keep the CDN version up-to-date so that we can fix bugs and add new features and you won't have to change anything. <a href="https://github.com/nprapps/pym.js/tree/master#versioning">Learn more about our versioning strategy.</a></p>

                      <ul>
                          <li><a href="https://pym.nprapps.org/pym-loader.v1.js">https://pym.nprapps.org/pym-loader.v1.js (Uncompressed)</a> (4 KB)</li>
                          <li><a href="https://pym.nprapps.org/pym-loader.v1.min.js">https://pym.nprapps.org/pym-loader.v1.min.js (Compressed)</a> (1 KB)</li>
                      </ul>

                      <p>We recommend using <code>https</code>, but the unsecure <code>http</code> protocol is also supported if you need it.</p>


                    <h3 id="get-pym-loader-download">Download pym-loader.js</h3>
                    <ul>
                        <li><a href="dist/pym-loader.v1.js">Uncompressed</a> (4 KB)</li>
                        <li><a href="dist/pym-loader.v1.min.js">Compressed</a> (&lt;1 KB)</li>
                    </ul>
                </section>

                <section id="status-custom-events">
                    <h3>Pym Status Custom Events</h3>
                    <p> Starting on <code>v1.2.0</code> we have added Custom Events that can be listened to in order to determine some key events that happen inside <code>Pym.js</code>.</p>
                    <p>We have added two Custom Events, one inside <code>pym-loader.js</code> and one inside <code>Pym.js</code>.</p>

                    <ul>
                        <li><code>pym-loader:pym-loaded</code> &rarr; This event signals when the loader has finished loading <code>Pym.js</code>. You can listen to it following this example.</li>
<pre><code>document.addEventListener('pym-loader:pym-loaded', function (e) {
    console.log("pym-loaded event fired");
    console.log(pym);
}, false);
</code></pre>
                        <li><code>pym:pym-initialized</code> &rarr; This event signals when <code>Pym.js</code> has finished executing its autoinitialization. You can listen to it following this example.</li>
<pre><code>document.addEventListener('pym:pym-initialized', function (e) {
    console.log("pym-initialized event fired);
    console.log(pym.autoInitInstances.length);
}, false);
</code></pre>
                    </ul>
                </section>

                <section id="in-the-wild">
                    <h3>Pym.js in the wild</h3>

                    <ul>
                        <li><a href="http://time.com/58386/happiest-facebook-friends/">Time</a> used it to get around cross-domain issues.</li>
                        <li><a href="http://www.texastribune.org/2014/05/11/tim-dunn-far-right-has-big-spender-who-gets-result/">Texas Tribune</a> used it to to embed responsive tables.</a></li>
                        <li><a href="http://www.pbs.org/newshour/updates/country-comes-parenting-values/">PBS Newshour</a> made a responsive survey.</li>
                        <li>The <a href="https://nerds.inn.org/discounts/">Institute for Nonprofit News</a> created responsive tables and a <a href="https://github.com/INN/responsive-tables">framework</a> for making them quickly.
                        <li><a href="http://fivethirtyeight.com/interactives/pollster-ratings/">538</a> rated pollsters in a responsive table</li>
                        <li><a href="http://www.kunc.org/post/watch-greeley-get-surrounded-15000-oil-wells-13-years">KUNC</a> used it to embed animated GIFs and small chunks of code in their CorePublisher site</li>
                        <li><a href="http://news.stlpublicradio.org/post/stlpr-christmas-poetry-quiz">St. Louis Public Radio</a> built it into a news quiz that they embedded into a CorePublisher post</li>
                        <li>The UK's <a href="http://visual.ons.gov.uk/uk-perspectives-the-changing-population/">Office of National Statistics</a> uses it to embed responsive graphics into blog posts. (<a href="https://www.dxw.com/2015/01/official-data-new-light-another-dxw-project-goes-live/">More</a>)</li>
                        <li>The UK's <a href="http://www.channel4.com/news/from-farage-to-ferguson-that-was-the-year-that-was">Channel 4</a> used it to embed a full-page 2014 year-in-review feature.</li>
                        <li>The <a href="bostonglobe-graphic-tsarnaev-trial">Boston Globe</a> used it to embed Boston Marathon bombing trial updates.</li>
                    </ul>

                </section>

                <section id="license">
                    <h3>License</h3>
                    <p><a href="https://github.com/nprapps/responsiveiframe/blob/master/LICENSE">MIT</a></p>
                </section>

                <footer>
                    <p>Pym.js was built by the <a href="http://github.com/nprapps">NPR Visuals</a> team, based on work by the <a href="https://github.com/npr/responsiveiframe">NPR Tech Team</a> and <a href="https://github.com/ioseb">Ioseb Dzmanashvili</a>. Thanks to <a href="https://twitter.com/erikhinton">Erik Hinton</a> for suggesting the name.</p>

                    <p>With the help of all these <a href="https://github.com/nprapps/responsiveiframe/blob/master/CONTRIBUTORS">contributors</a></p>
                </footer>
            </div>
        </div>

    <script type="text/javascript" src="src/pym.js"></script>
    <script>
        new pym.Parent('example-table', 'examples/table/child.html', {});
        new pym.Parent('example-graphic', 'examples/graphic/child.html', {});
        new pym.Parent('example-quiz', 'examples/quiz/child.html', {});
        new pym.Parent('example-follow-links', 'examples/follow-links/child.html', {});
        new pym.Parent('example-navigation', 'examples/navigation/child.html', {});
    </script>

    </body>
</html>
